<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leaflet Map</title>
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.css" />
    <!-- Firebase App (the core Firebase SDK) -->
    <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/3.1.0/firebase.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-database.js"></script>

    <!-- Custom CSS -->
    <style>
        body,
        html {
            height: 100%;
            margin: 0;
            font-family: Arial, Helvetica, sans-serif;
        }

        #map {
            height: 100%;
        }

        .leaflet-control-attribution {
            display: none;
        }

        .leaflet-routing-container {
            display: none !important;
        }
    </style>
</head>

<body>
    <div id="map"></div>
    <!-- <div>Total Keys: <span id="key-count">Loading...</span></div> -->




    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <!-- Routing Machine JS -->
    <script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"></script>
    <!-- Initialize the map -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
        import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-database.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            // ... your config details
            apiKey: "AIzaSyDbG9crbJCKAQtuIry5guBxWJpSd31OdOM",
            authDomain: "trafficcngestion.firebaseapp.com",
            databaseURL: "https://trafficcngestion-default-rtdb.firebaseio.com",
            projectId: "trafficcngestion",
            storageBucket: "trafficcngestion.appspot.com",
            messagingSenderId: "1050456041831",
            appId: "1:1050456041831:web:6dd79b0f1b31e0f742e7c2",
            measurementId: "G-R9DPGQWXNX"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        console.log(db);

        function readData() {
            const userRef = ref(db, '/'); // Assuming you want data from the root

            return get(userRef).then((snapshot) => {
                let count = 0; // Initialize count inside the Promise

                snapshot.forEach((childSnapshot) => {
                    //   console.log(childSnapshot.val());
                    count++; // Increment count within the loop
                });

                return count; // Return count after all data is processed
            });
        }

        // Usage
        readData().then((dataCount) => {
            console.log("Number of data elements:", dataCount);
            for (let i = 0; i < dataCount-2; i++) {
                var color = `rgb(${5 + 24 * i}, ${110 - 8 * i}, ${245 - 24 * i})`; // Generate dynamic color
                var ChangeRoutColor = {
                    color,
                    weight: 6,
                    
                };

            }



       

        // for (i=0, i==da)
        // Custom styles for the route
        var customRouteStyle = {
            color: '#05B669', // Change the color here
            weight: 8
        };

        // var ChangeRoutColor = {
        //     color: 'rgb(55,55,55)', // Change the color here
        //     weight: 3
        // };

        // Create a map instance
        const map = L.map('map').setView([30.284016, 78.782959], 11);

        var Stadia_AlidadeSatellite = L.tileLayer('https://tiles.stadiamaps.com/tiles/alidade_satellite/{z}/{x}/{y}{r}.{ext}', {
            minZoom: 0,
            maxZoom: 20,
            attribution: '&copy; CNES, Distribution Airbus DS, © Airbus DS, © PlanetObserver (Contains Copernicus Data) | &copy; <a href="https://www.stadiamaps.com/" target="_blank">Stadia Maps</a> &copy; <a href="https://openmaptiles.org/" target="_blank">OpenMapTiles</a> &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
            ext: 'jpg'
        }).addTo(map);

        // Add a marker to the map
        const marker = L.marker([30.368935, 78.439477]).addTo(map)
            .bindPopup('Tehri Garhwal')
            .openPopup();

        function onMapClick(e) {
            alert("You clicked the map at " + e.latlng);
        }

        L.Routing.control({
            waypoints: [
                L.latLng(30.142838, 78.608551),
                L.latLng(30.254484, 79.216919)
            ],
            createMarker: function () { return null; },
            draggableWaypoints: false,
            lineOptions: {
                styles: [customRouteStyle]
            }

        }).addTo(map);

        L.Routing.control({
            waypoints: [
                L.latLng(30.254484, 79.216919),
                L.latLng(30.223016, 78.785622),
            ],
            createMarker: function () { return null; },
            draggableWaypoints: false,
            lineOptions: {
                styles: [ChangeRoutColor]
            }
        }).addTo(map);

        L.marker([30.142838, 78.608551]).addTo(map);
        L.marker([30.254484, 79.216919]).addTo(map);

        map.on('click', onMapClick);

        // Add a circle to the map
        const circle = L.circle([30.223016, 78.785622], {
            color: 'red',
            fillColor: '#f03',
            fillOpacity: 0.5,
            radius: 1000
        }).addTo(map); });
    </script>

</body>

</html>